= Eleventy Bookshop
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:toc:
:toc-placement!:

toc::[]

== Quick start
To jump right into using Bookshop on an Eleventy site, check out the link:https://github.com/CloudCannon/eleventy-bookshop-starter[Eleventy Bookshop Starter] 

NOTE: Currently, Bookshop only supports liquid templating on Eleventy sites.

== Bookshop Configuration

Reference the Eleventy engine in your Bookshop configuration file. Bookshop expects this package to be installed in your working directory, usually your site, _not_ in your Bookshop project.
.*bookshop.config.js*
```javascript
module.exports = {
    engines: {
        "@bookshop/eleventy-engine": {}
    }
}
```

.*command*
```bash
cd site/
npm i -D @bookshop/eleventy-engine
# or
yarn add -D @bookshop/eleventy-engine
```

== Eleventy Configuration

To use Bookshop with Eleventy, the primary dependency is the `@bookshop/eleventy-bookshop` npm package.

.*command*
```bash
npm i @bookshop/eleventy-bookshop
# or
yarn add @bookshop/eleventy-bookshop
```

Within your Eleventy config, specify the path to your Bookshop project. 

TIP: If you specify multiple paths, the components will be merged.

TIP: Paths that don't exist will be skipped. If you specify local and production paths, the one that exists will be used.

.*.eleventy.js*
```javascript
const pluginBookshop = require("@bookshop/eleventy-bookshop");

module.exports = function (eleventyConfig) {
  // ...

	eleventyConfig.addPlugin(pluginBookshop({
		bookshopLocations: ["component-library"]
	}));

  // ...
};
```

== Writing components

Let's look at an example `button.eleventy.liquid` file.
```
components/
└─ button/
   └─ button.eleventy.liquid
```
These files are namespaced for the static site generator when the filetype is ambiguous, which is why the file is `button.eleventy.liquid` and not `button.liquid`. Beyond the naming convention, these files are what you would expect when working with Liquid & Eleventy. Our `button.eleventy.liquid` file might look like:
```hbs
<a class="c-button" href="{{ link_url }}">{{ text }}</a>
```
This looks like a normal Eleventy include because... it is. While Bookshop provides developer tooling, the job of eleventy-bookshop is to tell Eleventy where to find component files. Loading and parsing these files goes through the normal Eleventy include flow.

TIP: The `@bookshop/init` package helps create component structures for you. Running `npx @bookshop/init --component button` would create the button structure needed for Eleventy.

== Using components

To use components directly in a template, use the `{% bookshop %}` tag like you would an include.

.*index.html*
```liquid
...
<div class="hero">
  {% bookshop "hero" title: title image: image %}
  {% bookshop "button" label: cta_text link_url: cta_url %}
</div>
...
```

Inside a loop, a variable can be used to render the component from a given key:

.*index.html*
```liquid
---
components:
  - _bookshop_name: hero
    title: "Hello World"
    image: /image.png
  - _bookshop_name: button
    cta_text: "Get Started"
    link_url: /
---
<div class="hero">
  {% for props in components %}
    {% bookshop {{props._bookshop_name}} bind: props %}
  {% endfor %}
</div>
```

TIP: _Bookshop tags can use the `bind:` parameter, which works like the spread operator in Javascript. Here, all keys within the object `props` are unwrapped and passed to the component directly. If you're used to a framework like Svelte, this is the equivalent of `<Component {...props} />`_

TIP: _The structures generated by Bookshop for CloudCannon include the `_bookshop_name` field for you, so this can be used to render components dynamically_

== Using Bookshop Includes

Bookshop includes can be placed in the `shared/eleventy` directory. i.e:
```text
component-library/
├─ components/
└─ shared/
  └─ eleventy/
    └─ helper.eleventy.liquid
```

This can then be included using the `bookshop_include` tag:
```liquid
  {% bookshop_include "helper" lorem: "ipsum" %}
```

This is otherwise a standard Eleventy include, with the extra feature that it can be used anywhere within your Eleventy site _or_ your components.

== Using styles

To use Bookshop styles on your website, you can run the `bookshop-sass` command provided by `@bookshop/sass`.

.*command*
```bash
npm i -D @bookshop/sass
# or
yarn add -D @bookshop/sass

# then

npx @bookshop/sass -b component-library -o site/css/bookshop.css
```

From within your `package.json` file you can add the script as: 
```
"sass:build": "bookshop-sass -b component-library -o site/css/bookshop.css",
"sass:watch": "bookshop-sass -b component-library -o site/css/bookshop.css -w"
```

This compiles all styles from the Bookshop (including running any Postcss plugins you have configured in your working directory), and outputs a css file ready to be referenced on your website.

Reference `npx @bookshop/sass --help` to see the available options.

== Component Library

Setting up the component library is fairly framework agnostic, so following the steps in the link:guides/browser.adoc[Component Browser Guide] should see you on your way.

== Live Editing

Bookshop experimentally supports automatic live previews when editing on CloudCannon. +
In Eleventy, this can be added with the `@bookshop/cloudcannon-eleventy-bookshop` npm package.

```bash
npm i @bookshop/cloudcannon-eleventy-bookshop
# or
yarn add @bookshop/cloudcannon-eleventy-bookshop
```

.*.eleventy.js*
```javascript
const pluginBookshop = require("@bookshop/eleventy-bookshop");
const pluginCloudCannonBookshop = require("@bookshop/cloudcannon-eleventy-bookshop");

module.exports = function (eleventyConfig) {
  // ...

	eleventyConfig.addPlugin(pluginBookshop({
		bookshopLocations: ["component-library"]
	}));
	eleventyConfig.addPlugin(pluginCloudCannonBookshop);

  // ...
};
```

With that dependency installed, follow the instructions in the link:guides/live-editing.adoc[Live Editing Guide]
